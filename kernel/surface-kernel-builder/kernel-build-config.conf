#
# PERFORMANCE CONFIGURATION
#

# CPU Architecture Optimization
# Options: x86-64, x86-64-v3, x86-64-v4, native
# x86-64-v3: Recommended for modern CPUs (2015+)
# x86-64-v4: For latest CPUs with AVX-512 support
# native: Optimize for your specific CPU (not portable)
CPU_ARCH="x86-64-v3"

# Link Time Optimization (LTO)
# Options: none, thin, full
# thin: Recommended - good balance of performance and build time
# full: Maximum optimization but slower build
# none: Fastest build, less optimization
ENABLE_LTO="thin"

# Profile Guided Optimization (PGO)
# Options: yes, no
# Improves performance but increases build time significantly
ENABLE_PGO="no"

# Timer Frequency (Hz)
# Options: 100, 250, 300, 500, 600, 750, 1000
# Higher = more responsive, slightly more power usage
# 1000Hz recommended for desktop use
TIMER_FREQ="1000"

# Preemption Model
# Options: none, voluntary, full
# full: Best for desktop responsiveness
# voluntary: Good balance for servers
# none: Lowest latency variance, server workloads
PREEMPT_MODEL="full"

# CPU Scheduler
# Options: bore, eevdf, bmq
# bore: Best overall desktop performance (recommended)
# eevdf: Default Linux scheduler, good all-around
# bmq: BitMap Queue scheduler, good for gaming
SCHEDULER="bore"

#
# HARDWARE SUPPORT
#

# ZFS Filesystem Support
# Options: yes, no
# Adds ZFS support but increases build time and kernel size
ENABLE_ZFS="yes"

# NVIDIA Driver Support
# Options: yes, no
# Includes patches for better NVIDIA compatibility
# Essential for Surface Laptop Studio 1 with discrete GPU
ENABLE_NVIDIA="yes"

# Surface Hardware Features
# All enabled by default for Surface Laptop Studio 1
ENABLE_SURFACE_SAM="yes"         # Surface Aggregator Module (required)
ENABLE_SURFACE_TOUCH="yes"       # Touchscreen support
ENABLE_SURFACE_PEN="yes"         # Surface Pen support
ENABLE_SURFACE_CAMERAS="yes"     # Front/rear cameras
ENABLE_SURFACE_WIFI="yes"        # Enhanced WiFi support
ENABLE_SURFACE_AUDIO="yes"       # Surface audio improvements
ENABLE_SURFACE_POWER="yes"       # Power management
ENABLE_SURFACE_THERMAL="yes"     # Thermal management

#
# BUILD CONFIGURATION
#

# Parallel Build Jobs
# Set to number of CPU cores or leave empty for auto-detection
# Higher numbers = faster build but more memory usage
PARALLEL_JOBS=""

# Compiler Optimization Level
# Options: 2, 3, s, fast
# 2: Standard optimization (recommended)
# 3: Aggressive optimization (may cause issues) 
# s: Size optimization
# fast: Fast math optimizations
OPT_LEVEL="2"

# Debug Information
# Options: yes, no
# Include debugging symbols (larger kernel but better debugging)
ENABLE_DEBUG="no"

# Build Variant Name
# Custom name for your kernel build
BUILD_VARIANT="surface-cachy"

#
# ADVANCED FEATURES
#

# Memory Management
ENABLE_TRANSPARENT_HUGEPAGES="always"  # Options: always, madvise, never
ENABLE_KSM="yes"                       # Kernel Same-page Merging
ENABLE_ZSWAP="yes"                     # Compressed swap in RAM
ENABLE_NUMA_BALANCING="yes"            # NUMA memory balancing

# I/O Schedulers
DEFAULT_IO_SCHEDULER="bfq"             # Options: bfq, mq-deadline, kyber, none
ENABLE_BFQ_GROUP_SCHED="yes"           # BFQ cgroup scheduling

# Networking
ENABLE_BBR3="yes"                      # BBR3 TCP congestion control
ENABLE_TCP_OPTIMIZATIONS="yes"        # Various TCP improvements
ENABLE_NET_OPTIMIZATIONS="yes"        # Network stack optimizations

# Security Features
ENABLE_HARDENING="yes"                 # Kernel hardening features
ENABLE_KASLR="yes"                     # Kernel address space randomization
ENABLE_RETPOLINE="yes"                 # Spectre v2 mitigation
ENABLE_PAGE_TABLE_ISOLATION="yes"     # Meltdown mitigation

# Container Support
ENABLE_CONTAINERS="yes"                # Full container/Docker support
ENABLE_USER_NAMESPACES="yes"          # User namespace support
ENABLE_CGROUPS_V2="yes"               # Unified hierarchy cgroups

# Virtualization
ENABLE_KVM="yes"                       # KVM virtualization support
ENABLE_VFIO="yes"                      # VFIO for GPU passthrough

#
# SURFACE LAPTOP STUDIO 1 SPECIFIC
#

# GPU Configuration
INTEL_GPU_OPTIMIZATIONS="yes"          # Intel integrated GPU optimizations
NVIDIA_POWER_MANAGEMENT="dynamic"      # Options: dynamic, static, off
ENABLE_GPU_SWITCHING="yes"             # Hybrid graphics switching

# Display Configuration  
ENABLE_PSR="no"                        # Panel Self Refresh (can cause issues)
ENABLE_FBC="yes"                       # Frame Buffer Compression
ENABLE_DC_STATE="yes"                  # Display C-states for power saving

# Power Management
ENABLE_INTEL_PSTATE="yes"              # Intel P-State driver
ENABLE_POWERTOP_TUNABLES="yes"         # PowerTOP recommended settings
SLEEP_STATE="deep"                     # Options: s2idle, shallow, deep

# Thermal Configuration
THERMAL_GOVERNOR="step_wise"           # Options: step_wise, fair_share, power_allocator
ENABLE_THERMAL_SHUTDOWN="yes"         # Emergency thermal shutdown

# Audio Configuration
ENABLE_SOF_AUDIO="yes"                 # Sound Open Firmware for modern Intel audio
ENABLE_AUDIO_OPTIMIZATIONS="yes"      # Low-latency audio optimizations

#
# POST-BUILD ACTIONS
#

# Automatic installation
AUTO_INSTALL="no"                     # Automatically install after build
BACKUP_OLD_KERNEL="yes"               # Keep previous kernel as backup
UPDATE_GRUB_DEFAULT="yes"             # Set new kernel as default in GRUB

# System integration
INSTALL_SURFACE_TOOLS="yes"           # Install surface-firmware, iptsd, etc.
CONFIGURE_POWER_MANAGEMENT="yes"     # Apply power management optimizations
SETUP_NVIDIA_SETTINGS="yes"          # Configure NVIDIA settings

# Validation
RUN_KERNEL_TESTS="no"                 # Run kernel self-tests (time consuming)
GENERATE_SYSTEM_REPORT="yes"         # Generate system information report
